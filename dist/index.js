import{runInAction as n,makeAutoObservable as e}from"mobx";import{QueryClient as t,QueryObserver as o,InfiniteQueryObserver as r,MutationObserver as i}from"react-query/core";var u=function(){return u=Object.assign||function(n){for(var e,t=1,o=arguments.length;t<o;t++)for(var r in e=arguments[t])Object.prototype.hasOwnProperty.call(e,r)&&(n[r]=e[r]);return n},u.apply(this,arguments)};function l(n,e,t,o){return new(t||(t=Promise))((function(r,i){function u(n){try{s(o.next(n))}catch(n){i(n)}}function l(n){try{s(o.throw(n))}catch(n){i(n)}}function s(n){var e;n.done?r(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(u,l)}s((o=o.apply(n,e||[])).next())}))}function s(n,e){var t,o,r,i,u={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return i={next:l(0),throw:l(1),return:l(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function l(l){return function(s){return function(l){if(t)throw new TypeError("Generator is already executing.");for(;i&&(i=0,l[0]&&(u=0)),u;)try{if(t=1,o&&(r=2&l[0]?o.return:l[0]?o.throw||((r=o.return)&&r.call(o),0):o.next)&&!(r=r.call(o,l[1])).done)return r;switch(o=0,r&&(l=[2&l[0],r.value]),l[0]){case 0:case 1:r=l;break;case 4:return u.label++,{value:l[1],done:!1};case 5:u.label++,o=l[1],l=[0];continue;case 7:l=u.ops.pop(),u.trys.pop();continue;default:if(!(r=u.trys,(r=r.length>0&&r[r.length-1])||6!==l[0]&&2!==l[0])){u=0;continue}if(3===l[0]&&(!r||l[1]>r[0]&&l[1]<r[3])){u.label=l[1];break}if(6===l[0]&&u.label<r[1]){u.label=r[1],r=l;break}if(r&&u.label<r[2]){u.label=r[2],u.ops.push(l);break}r[2]&&u.ops.pop(),u.trys.pop();continue}l=e.call(n,u)}catch(n){l=[6,n],o=0}finally{t=r=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,s])}}}var a,c,f,d=new t({defaultOptions:{queries:{staleTime:3e5,retry:!1,refetchOnWindowFocus:!1}}}),h=function(n){(null==n?void 0:n.queryClient)&&(d=null==n?void 0:n.queryClient),(null==n?void 0:n.onQueryError)&&(a=null==n?void 0:n.onQueryError),(null==n?void 0:n.onInfiniteQueryError)&&(c=null==n?void 0:n.onInfiniteQueryError),(null==n?void 0:n.onMutationyError)&&(f=null==n?void 0:n.onMutationyError)},y=function(){function t(){var t=this;this.isMutationLoading=!1,this.isQueryLoading=!1,this.isFetchingNextPage=!1,this.isQueryFullLoading=!1,this.isQueryFetching=!1,this.fetchMutation=function(e,o){return void 0===o&&(o={hasToast:!0,rejectable:!0}),l(t,void 0,void 0,(function(){var t=this;return s(this,(function(r){return this.mutationResult=void 0,this.isMutationLoading=!1,[2,new Promise((function(r,l){var s=u(u({},e),{onSuccess:function(n,t,o){var i;null===(i=e.onSuccess)||void 0===i||i.call(e,n,t,o),r(n)},onError:function(n,t,r){(null==o?void 0:o.hasToast)&&(null==f||f(n)),e.onError&&e.onError(n,t,r)}}),a=new i(d,s);a.subscribe((function(e){n((function(){t.mutationResult=e,t.isMutationLoading=e.isLoading}))})),a.mutate().catch((function(n){return(null==o?void 0:o.rejectable)&&l(n)}))}))]}))}))},this.observer=new o(d,{}),this.fetchQuery=function(e,o){return void 0===o&&(o={hasToast:!0,rejectable:!0}),l(t,void 0,void 0,(function(){var t=this;return s(this,(function(r){return this.queryResult=void 0,this.isQueryLoading=!1,this.isQueryFullLoading=!0,[2,new Promise((function(r,i){var l=u(u({},e),{retry:!1,onSuccess:function(o){var i;null===(i=e.onSuccess)||void 0===i||i.call(e,o),r(o),n((function(){t.isQueryFullLoading=!1}))},onError:function(r){var u;(null==o?void 0:o.hasToast)&&(null==a||a(r)),null===(u=e.onError)||void 0===u||u.call(e,r),(null==o?void 0:o.rejectable)&&i(r),n((function(){t.isQueryFullLoading=!1}))}});t.observer.setOptions(l),t.observer.subscribe((function(e){n((function(){t.queryResult=e,t.isQueryLoading=Boolean(null==e?void 0:e.isLoading),t.isQueryFetching=Boolean(null==e?void 0:e.isFetching)}))})),t.queryResult=t.observer.getOptimisticResult(l),t.queryResult.data&&l.onSuccess&&l.onSuccess(t.queryResult.data)}))]}))}))},this.fetchInfiniteQuery=function(e,o){void 0===o&&(o={hasToast:!0,rejectable:!0}),t.queryResult=void 0,t.isQueryLoading=!1;var i=u(u({},e),{onError:function(n){(null==o?void 0:o.hasToast)&&(null==c||c(n)),e.onError&&e.onError(n)}}),l=new r(d,i);l.subscribe((function(e){n((function(){t.queryResult=e,t.isQueryLoading=Boolean(null==e?void 0:e.isLoading),t.isQueryFetching=Boolean(null==e?void 0:e.isFetching),t.isFetchingNextPage=Boolean(null==e?void 0:e.isFetchingNextPage)}))}));var s=l.getOptimisticResult(i);return s.data&&i.onSuccess&&i.onSuccess(s.data),l},e(this)}return Object.defineProperty(t.prototype,"isIdle",{get:function(){return!this.queryResult||"idle"===this.queryResult.status},enumerable:!1,configurable:!0}),Object.defineProperty(t.prototype,"isQueryNotReady",{get:function(){return this.isIdle||this.isQueryFullLoading},enumerable:!1,configurable:!0}),t}();export{y as AsyncService,h as configureAsyncService,d as queryClient};
